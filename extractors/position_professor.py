# position_professor.py - Generated by Extractor Generator Tool
"""
PositionProfessorExtractor - Data extractor for POSITION_PROFESSOR table

Generated on: 2025-12-11 14:55:09
CSV Inputs: WorkLoad
Dependencies: PROFESSOR, POSITION, SEMESTER_PLANNING

This extractor follows the DataExtractor contract for the database population system.
Modify the extract() method to implement your specific business logic.
"""

import pandas as pd
from typing import Dict, List, Any
from base_extractor import DataExtractor


class PositionProfessorExtractor(DataExtractor):
    """Extract data for POSITION_PROFESSOR table"""
    
    @property
    def table_name(self) -> str:
        """Return the database table name this extractor targets"""
        return "POSITION_PROFESSOR"
    
    @property
    def dependencies(self) -> List[str]:
        """Return list of table names this extractor depends on"""
        return ['PROFESSOR', 'POSITION', 'SEMESTER_PLANNING']
    
    def extract(self, WorkLoad: pd.DataFrame, professor: List[Dict[str, Any]], position: List[Dict[str, Any]], semester_planning: List[Dict[str, Any]], **kwargs) -> List[Dict[str, Any]]:
        
        professorPositionDF = WorkLoad[['term', 'name', 'job title', 'reduction']].drop_duplicates()

        # Map position names to their IDs
        position_name_to_id = {pos['PO_NAME']: pos['PO_ID'] for pos in position}

        # Map terms to their IDs
        term_name_to_id = {sem['SP_NAME']: sem['SP_ID'] for sem in semester_planning}

        # Map professor names to their IDs
        professor_name_to_id = {prof['P_NAME']: prof['P_ID'] for prof in professor}




        # Replace job titles with their corresponding position IDs
        professorPositionDF['PO_ID'] = professorPositionDF['job title'].map(position_name_to_id)

        # Replace terms with their corresponding semester planning IDs
        professorPositionDF['term'] = professorPositionDF['term'].map(term_name_to_id)

        # Replace professor names with their corresponding professor IDs
        professorPositionDF['P_ID'] = professorPositionDF['name'].map(professor_name_to_id)


        

        result = []
        for professorPositionDF in professorPositionDF.to_dict(orient='records'):  
                if professorPositionDF and str(professorPositionDF).strip():
                    result.append({
                        'P_ID': professorPositionDF['P_ID'],  # Foreign key to PROFESSOR.P_ID
                        'PO_ID': professorPositionDF['PO_ID'],  # Foreign key to POSITION.P_ID
                        'TERM': professorPositionDF['term'], # Foreign key to SEMESTER_PLANNING.SP_ID
                        'CREDIT_HOURS': int(str(professorPositionDF['reduction']).strip())
                    })
        return result
